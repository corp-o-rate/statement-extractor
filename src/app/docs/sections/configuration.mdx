## Configuration

<span id="configuration" />

The statement-extractor library provides fine-grained control over extraction behavior through configuration classes. This section covers all configuration options for tuning precision, recall, and performance.

---

### ExtractionOptions

<span id="extraction-options" />

The primary configuration class for controlling extraction behavior.

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>num_beams</code></td>
      <td>int</td>
      <td>4</td>
      <td>Number of beam search candidates</td>
    </tr>
    <tr>
      <td><code>diversity_penalty</code></td>
      <td>float</td>
      <td>1.0</td>
      <td>Penalty for beam diversity in diverse beam search</td>
    </tr>
    <tr>
      <td><code>max_new_tokens</code></td>
      <td>int</td>
      <td>2048</td>
      <td>Maximum generation length in tokens</td>
    </tr>
    <tr>
      <td><code>deduplicate</code></td>
      <td>bool</td>
      <td>True</td>
      <td>Remove duplicate statements from output</td>
    </tr>
    <tr>
      <td><code>merge_beams</code></td>
      <td>bool</td>
      <td>True</td>
      <td>Merge top beams into single result set (v0.2.0)</td>
    </tr>
    <tr>
      <td><code>embedding_dedup</code></td>
      <td>bool</td>
      <td>True</td>
      <td>Use embedding similarity for deduplication (v0.2.0)</td>
    </tr>
    <tr>
      <td><code>predicates</code></td>
      <td>list[str]</td>
      <td>None</td>
      <td>Predefined predicates for GLiNER2 relation extraction (v0.4.0)</td>
    </tr>
    <tr>
      <td><code>all_triples</code></td>
      <td>bool</td>
      <td>False</td>
      <td>Keep all candidate triples instead of best per source</td>
    </tr>
    <tr>
      <td><code>predicate_taxonomy</code></td>
      <td>PredicateTaxonomy</td>
      <td>None</td>
      <td>Taxonomy of canonical predicates</td>
    </tr>
    <tr>
      <td><code>scoring_config</code></td>
      <td>ScoringConfig</td>
      <td>None</td>
      <td>Quality scoring configuration</td>
    </tr>
    <tr>
      <td><code>entity_canonicalizer</code></td>
      <td>Callable</td>
      <td>None</td>
      <td>Custom function for entity canonicalization</td>
    </tr>
  </tbody>
</table>

**Basic usage:**

```python
from statement_extractor import ExtractionOptions, extract_statements

options = ExtractionOptions(
    num_beams=6,
    diversity_penalty=1.2,
    deduplicate=True
)

result = extract_statements("Apple acquired Beats for $3 billion.", options)
```

---

### ScoringConfig

<span id="scoring-config" />

*Added in v0.2.0*

Configuration for quality scoring, filtering, and beam selection. Use this to tune the precision-recall tradeoff.

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>min_confidence</code></td>
      <td>float</td>
      <td>0.0</td>
      <td>Filter threshold (0=recall, 0.7+=precision)</td>
    </tr>
    <tr>
      <td><code>quality_weight</code></td>
      <td>float</td>
      <td>1.0</td>
      <td>Weight for confidence scores</td>
    </tr>
    <tr>
      <td><code>coverage_weight</code></td>
      <td>float</td>
      <td>0.5</td>
      <td>Weight for source text coverage</td>
    </tr>
    <tr>
      <td><code>redundancy_penalty</code></td>
      <td>float</td>
      <td>0.3</td>
      <td>Penalty for duplicate triples</td>
    </tr>
    <tr>
      <td><code>length_penalty</code></td>
      <td>float</td>
      <td>0.1</td>
      <td>Penalty for verbose predicates/entities</td>
    </tr>
    <tr>
      <td><code>merge_top_n</code></td>
      <td>int</td>
      <td>3</td>
      <td>Number of beams to merge</td>
    </tr>
  </tbody>
</table>

**Common configurations:**

```python
from statement_extractor import ScoringConfig, ExtractionOptions, extract_statements

# High precision mode - only keep confident extractions
precision_config = ScoringConfig(
    min_confidence=0.7,
    quality_weight=1.5,
    redundancy_penalty=0.5
)

# High recall mode - keep everything
recall_config = ScoringConfig(
    min_confidence=0.0,
    quality_weight=0.5,
    redundancy_penalty=0.1
)

# Use in extraction
options = ExtractionOptions(scoring_config=precision_config)
result = extract_statements(text, options)
```

**Precision vs recall tuning:**

<table>
  <thead>
    <tr>
      <th>Use Case</th>
      <th>min_confidence</th>
      <th>quality_weight</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Maximum recall</td>
      <td>0.0</td>
      <td>0.5</td>
      <td>Keep all extractions</td>
    </tr>
    <tr>
      <td>Balanced</td>
      <td>0.4</td>
      <td>1.0</td>
      <td>Good default</td>
    </tr>
    <tr>
      <td>High precision</td>
      <td>0.7</td>
      <td>1.5</td>
      <td>Fewer false positives</td>
    </tr>
    <tr>
      <td>Knowledge base</td>
      <td>0.8</td>
      <td>2.0</td>
      <td>Very strict</td>
    </tr>
  </tbody>
</table>

---

### PredicateComparisonConfig

<span id="predicate-config" />

*Added in v0.2.0*

Configuration for embedding-based predicate comparison and taxonomy matching. Requires the `[embeddings]` extra.

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>embedding_model</code></td>
      <td>str</td>
      <td>paraphrase-MiniLM-L6-v2</td>
      <td>Model for computing similarity</td>
    </tr>
    <tr>
      <td><code>similarity_threshold</code></td>
      <td>float</td>
      <td>0.65</td>
      <td>Minimum similarity for taxonomy matching</td>
    </tr>
    <tr>
      <td><code>dedup_threshold</code></td>
      <td>float</td>
      <td>0.65</td>
      <td>Minimum similarity to consider duplicates</td>
    </tr>
    <tr>
      <td><code>normalize_text</code></td>
      <td>bool</td>
      <td>True</td>
      <td>Lowercase/strip predicates before embedding</td>
    </tr>
  </tbody>
</table>

**Custom thresholds:**

```python
from statement_extractor import (
    PredicateComparisonConfig,
    PredicateTaxonomy,
    ExtractionOptions,
    extract_statements
)

# Stricter matching for precision
config = PredicateComparisonConfig(
    similarity_threshold=0.75,
    dedup_threshold=0.80,
    normalize_text=True
)

taxonomy = PredicateTaxonomy.from_list([
    "acquired", "founded", "works_for", "located_in",
    "partnered_with", "invested_in", "announced"
])

options = ExtractionOptions(
    predicate_taxonomy=taxonomy,
    predicate_config=config
)

result = extract_statements("Google bought YouTube in 2006.", options)
```

---

### PipelineConfig

<span id="pipeline-config" />

<span className="text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-0.5 rounded">NEW in v0.5.0</span>

Configuration for the 5-stage extraction pipeline. Controls which stages run, which plugins are enabled, and stage-specific options.

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>enabled_stages</code></td>
      <td>set[int]</td>
      <td>{"{1, 2, 3, 4, 5}"}</td>
      <td>Stages to run (1-6)</td>
    </tr>
    <tr>
      <td><code>enabled_plugins</code></td>
      <td>set[str] | None</td>
      <td>None</td>
      <td>Plugins to enable (None = all)</td>
    </tr>
    <tr>
      <td><code>disabled_plugins</code></td>
      <td>set[str]</td>
      <td>set()</td>
      <td>Plugins to disable</td>
    </tr>
    <tr>
      <td><code>fail_fast</code></td>
      <td>bool</td>
      <td>False</td>
      <td>Stop on first error</td>
    </tr>
    <tr>
      <td><code>parallel_processing</code></td>
      <td>bool</td>
      <td>False</td>
      <td>Enable parallel processing</td>
    </tr>
    <tr>
      <td><code>max_statements</code></td>
      <td>int | None</td>
      <td>None</td>
      <td>Limit statements processed</td>
    </tr>
  </tbody>
</table>

**Stage selection examples:**

```python
from statement_extractor.pipeline import PipelineConfig, ExtractionPipeline

# Run only splitting and extraction (stages 1-2)
config = PipelineConfig(enabled_stages={1, 2})

# Run stages 1-3 (skip canonicalization and labeling)
config = PipelineConfig(enabled_stages={1, 2, 3})

# From stage string
config = PipelineConfig.from_stage_string("1-3")  # {1, 2, 3}
config = PipelineConfig.from_stage_string("1,2,5")  # {1, 2, 5}

# Use presets
config = PipelineConfig.default()   # All 5 stages
config = PipelineConfig.minimal()   # Stages 1-2 only
```

**Plugin selection examples:**

```python
# Disable specific plugins
config = PipelineConfig(
    disabled_plugins={"sec_edgar_qualifier", "companies_house_qualifier"}
)

# Enable only specific plugins
config = PipelineConfig(
    enabled_plugins={"t5_gemma_splitter", "gliner2_extractor", "person_qualifier"}
)
```

**Stage-specific options:**

```python
config = PipelineConfig(
    splitter_options={
        "num_beams": 6,
        "diversity_penalty": 1.2,
    },
    extractor_options={
        "predicates_file": "/path/to/custom_predicates.json",  # Custom predicate file
    },
    qualifier_options={
        "timeout": 10.0,  # API timeout
    },
)
```

**GLiNER2 Extractor Options:**

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>predicates_file</code></td>
      <td>str | Path</td>
      <td>None</td>
      <td>Path to custom predicates JSON file</td>
    </tr>
    <tr>
      <td><code>predicates</code></td>
      <td>list[str]</td>
      <td>None</td>
      <td>Custom list of predicate names (overrides file)</td>
    </tr>
    <tr>
      <td><code>entity_types</code></td>
      <td>list[str]</td>
      <td>all types</td>
      <td>Entity types to extract</td>
    </tr>
    <tr>
      <td><code>use_default_predicates</code></td>
      <td>bool</td>
      <td>True</td>
      <td>Use 324 built-in predicates when no custom ones provided</td>
    </tr>
  </tbody>
</table>

**Custom Predicates File Format:**

```json
{
  "category_name": {
    "predicate_name": {
      "description": "Description for semantic matching",
      "threshold": 0.7
    }
  }
}
```

Example:
```json
{
  "employment": {
    "works_for": {"description": "Employment relationship", "threshold": 0.75},
    "manages": {"description": "Management relationship", "threshold": 0.7}
  },
  "ownership": {
    "owns": {"description": "Ownership relationship", "threshold": 0.7},
    "acquired": {"description": "Acquisition of entity", "threshold": 0.75}
  }
}
```

---

### Stage Combinations

<span id="stage-combinations" />

Common stage combinations for different use cases:

<table>
  <thead>
    <tr>
      <th>Use Case</th>
      <th>Stages</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Fast extraction</td>
      <td>{"{1, 2}"}</td>
      <td>Basic triples with entity types</td>
    </tr>
    <tr>
      <td>With qualifiers</td>
      <td>{"{1, 2, 3}"}</td>
      <td>Add roles, identifiers (no canonicalization)</td>
    </tr>
    <tr>
      <td>Full resolution</td>
      <td>{"{1, 2, 3, 4}"}</td>
      <td>Canonical forms, FQNs (no labeling)</td>
    </tr>
    <tr>
      <td>Full pipeline</td>
      <td>{"{1, 2, 3, 4, 5}"}</td>
      <td>All stages except taxonomy</td>
    </tr>
    <tr>
      <td>Complete pipeline</td>
      <td>{"{1, 2, 3, 4, 5}"}</td>
      <td>All stages including taxonomy</td>
    </tr>
    <tr>
      <td>Labeling only</td>
      <td>{"{1, 2, 5}"}</td>
      <td>Skip qualification/canonicalization</td>
    </tr>
  </tbody>
</table>

```python
# Fast extraction for high-volume processing
fast_config = PipelineConfig.minimal()

# Full resolution for knowledge graph building
full_config = PipelineConfig.default()

# Custom: qualifiers without external APIs
internal_config = PipelineConfig(
    enabled_stages={1, 2, 3, 4, 5},
    disabled_plugins={"gleif_qualifier", "companies_house_qualifier", "sec_edgar_qualifier"},
)
```
